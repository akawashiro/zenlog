#!/bin/bash

cat <<'EOF'

#==============================================================================
# Simple setup script for Zsh.
#
# Add the following line to your $HOME/.zrc file.
#
# . <(zenlog basic-zsh-setup)
#==============================================================================

EOF

zenlog basic-xsh-setup

cat <<'EOF'

#==============================================================================
# Set up hot keys.
# - Press ALT+1 on prompt to open the last log.
# - Press ALT+2 on prompt to open the last log file on the web browser *with color*.
#   (Must install a2h.)
# - Press ALT+3 / ALT+4 Similar, but select a log with FZF.
#==============================================================================

zle -N open_last_log
zle -N open_last_raw
zle -N open_selected_log
zle -N open_selected_raw

bindkey "\e1" open_last_log
bindkey "\e2" open_last_raw
bindkey "\e3" open_selected_log
bindkey "\e4" open_selected_raw

#==============================================================================
# Pre/post exec hooks.
#==============================================================================

zenlog_zsh_basic_precmd() {
    local last_status=$?
    local lines=$(zenlog_zsh_postexec -n "$last_status")
    local last_log="$(zenlog current-log)"

    if [[ -n "$last_log" ]]; then
        echo -e "[\e[0;44mrc=$last_status log=$last_log (${lines:-n/a} lines)\e[0m]"
    fi
}

if zenlog in-zenlog; then
    precmd_functions=(zenlog_zsh_basic_precmd "$precmd_functions[@]")
    preexec_functions+=(zenlog_zsh_preexec)
fi

EOF
