#!/bin/bash

cat <<'EOF'

export ZENLOG_VIEWER=${ZENLOG_VIEWER:-less}

export ZENLOG_BIN="${ZENLOG_BIN:-zenlog}"

# Install the basic shell helper functions.
. <("$ZENLOG_BIN" sh-helper)

#==============================================================================
# Functions for hot keys.
#==============================================================================

open_last_log() {
  "$ZENLOG_BIN" open-current-log
}

open_selected_log() {
  "$ZENLOG_BIN" open-log
}

open_zenlog_raw_with_browser() {
  local log="$1"
  local temp="$(tempfile)"

  a2h "$log" > "$temp" || {
    echo "Failed to execute A2H. Install it from https://github.com/omakoto/a2h-rs." 1>&2
    return 1
  }
  "${ZENLOG_RAW_VIEWER:-google-chrome}" "$temp"
}

open_last_raw() {
  open_zenlog_raw_with_browser "$("$ZENLOG_BIN" current-log -r)"
}

open_selected_raw() {
  open_zenlog_raw_with_browser "$("$ZENLOG_BIN" select-log -r)"
}

EOF
